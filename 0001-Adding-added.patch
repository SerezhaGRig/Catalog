From 47d197386c0ae41a08850b031d2fa16c6feb4c78 Mon Sep 17 00:00:00 2001
From: Serezha Grigoryan <sgrigoryan@dlink.ru>
Date: Tue, 9 Feb 2021 15:19:52 +0400
Subject: [PATCH] Adding added

---
 .idea/compiler.xml                            |  6 +++
 .idea/gradle.xml                              |  1 +
 .idea/misc.xml                                |  2 +-
 app/build.gradle                              |  1 +
 .../java/com/myapp/catalog/FirebaseStruct.kt  | 45 ++++++++++++++-----
 .../java/com/myapp/catalog/MainActivity.kt    |  6 +--
 .../main/java/com/myapp/catalog/Products.kt   |  2 +-
 .../com/myapp/catalog/ProductsDatabase.kt     |  2 +-
 8 files changed, 48 insertions(+), 17 deletions(-)
 create mode 100644 .idea/compiler.xml

diff --git a/.idea/compiler.xml b/.idea/compiler.xml
new file mode 100644
index 0000000..61a9130
--- /dev/null
+++ b/.idea/compiler.xml
@@ -0,0 +1,6 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<project version="4">
+  <component name="CompilerConfiguration">
+    <bytecodeTargetLevel target="1.8" />
+  </component>
+</project>
\ No newline at end of file
diff --git a/.idea/gradle.xml b/.idea/gradle.xml
index 5cd135a..9bba60d 100644
--- a/.idea/gradle.xml
+++ b/.idea/gradle.xml
@@ -14,6 +14,7 @@
           </set>
         </option>
         <option name="resolveModulePerSourceSet" value="false" />
+        <option name="useQualifiedModuleNames" value="true" />
       </GradleProjectSettings>
     </option>
   </component>
diff --git a/.idea/misc.xml b/.idea/misc.xml
index 37a7509..d5d35ec 100644
--- a/.idea/misc.xml
+++ b/.idea/misc.xml
@@ -1,6 +1,6 @@
 <?xml version="1.0" encoding="UTF-8"?>
 <project version="4">
-  <component name="ProjectRootManager" version="2" languageLevel="JDK_1_7" project-jdk-name="1.8" project-jdk-type="JavaSDK">
+  <component name="ProjectRootManager" version="2" languageLevel="JDK_1_8" default="true" project-jdk-name="1.8" project-jdk-type="JavaSDK">
     <output url="file://$PROJECT_DIR$/build/classes" />
   </component>
   <component name="ProjectType">
diff --git a/app/build.gradle b/app/build.gradle
index 870d11c..8e85c92 100644
--- a/app/build.gradle
+++ b/app/build.gradle
@@ -48,5 +48,6 @@ dependencies {
     // Declare the dependency for the Realtime Database library
     // When using the BoM, you don't specify versions in Firebase library dependencies
     implementation 'com.google.firebase:firebase-database-ktx'
+    implementation 'com.google.firebase:firebase-storage'
 
 }
diff --git a/app/src/main/java/com/myapp/catalog/FirebaseStruct.kt b/app/src/main/java/com/myapp/catalog/FirebaseStruct.kt
index b034c84..9266d87 100644
--- a/app/src/main/java/com/myapp/catalog/FirebaseStruct.kt
+++ b/app/src/main/java/com/myapp/catalog/FirebaseStruct.kt
@@ -1,28 +1,51 @@
 package com.myapp.catalog
 
+import android.net.Uri
 import android.util.Log
 import android.widget.Toast
 import com.google.firebase.auth.FirebaseAuth
 import com.google.firebase.database.ktx.database
 import com.google.firebase.ktx.Firebase
+import com.google.firebase.storage.FirebaseStorage
+import java.util.*
+import kotlin.collections.HashMap
 
 data class Work(val name: String? = null, val description: String? = null,
                 val userId: String? = null, val cost: String? = null,
-                val categ: String? = null){
+                val category: String? = null,val image1: String? = null,
+                val image2: String? = null,val image3: String? = null){
     companion object{
         fun addInFBase(product: Product) {
             val id = FirebaseAuth.getInstance().currentUser?.uid
-            val work = Work(product.name, product.description, id, product.cost, product.category)
+            val work = Work(product.name, product.description, id, product.cost, product.category
+                , putImage(product.image1),putImage(product.image2),putImage(product.image3))
             val database = Firebase.database.reference
-            val workRef = database.child("works")//.setValue(work)
-
-            val key = workRef.push().key
-            key?.let { workRef.child(it).setValue(work) }
-            workRef.get().addOnSuccessListener {
-                val list = it.getValue() as HashMap<*,*>
-                Log.i("mylog",list.keys.toString())
-                Log.i("mylog",list["-MSxk-daghvvBjJlaUan"].toString())
+            val workRef = database.child("works")
+            workRef.setValue(work)
+        }
+        private fun putImage(image1: String?):String{
+            val storageRef=FirebaseStorage.getInstance().reference
+            val keyIm1 = "images/"+UUID.randomUUID().toString()
+            val im1Ref=storageRef.child(keyIm1)
+            val uriIm1=Uri.parse(image1)
+            im1Ref.putFile(uriIm1)
+            return keyIm1
+        }
+        fun selectWorks():Products{
+            val works = Firebase.database.reference.child("works").get().addOnSuccessListener {
+                it?.let {
+                    for (item in it.value as HashMap<*,*>){
+
+                    }
+
+
+                }
+
+
+
             }
-    }
+
+        }
+        }
     }
 }
diff --git a/app/src/main/java/com/myapp/catalog/MainActivity.kt b/app/src/main/java/com/myapp/catalog/MainActivity.kt
index 6832303..04159a3 100644
--- a/app/src/main/java/com/myapp/catalog/MainActivity.kt
+++ b/app/src/main/java/com/myapp/catalog/MainActivity.kt
@@ -34,9 +34,9 @@ class MainActivity : AppCompatActivity(),NavigationView.OnNavigationItemSelected
         //lateinit var myDataset:Products
         super.onCreate(savedInstanceState)
         setContentView(R.layout.activity_main)
-        val list = arrayListOf<String>("hello","pello","ello")
-        val product = Product("Sero","cragravorox","1000$","it",list)
-        Work.addInFBase(product)
+        //val list = arrayListOf<String>("hello","pello","ello")
+        //val product = Product("Sero","cragravorox","1000$","it",list)
+        //Work.addInFBase(product)
         val toolbar: Toolbar = findViewById(R.id.toolbar)
         setSupportActionBar(toolbar)
         requestedOrientation = ActivityInfo.SCREEN_ORIENTATION_PORTRAIT
diff --git a/app/src/main/java/com/myapp/catalog/Products.kt b/app/src/main/java/com/myapp/catalog/Products.kt
index fe57179..8e141d8 100644
--- a/app/src/main/java/com/myapp/catalog/Products.kt
+++ b/app/src/main/java/com/myapp/catalog/Products.kt
@@ -207,7 +207,7 @@ class Product
         }
     }
 }
-class Products(val context: Context)
+class Products()//val context: Context)
 {
     val prList = ArrayList<Product>()
     /*fun load()
diff --git a/app/src/main/java/com/myapp/catalog/ProductsDatabase.kt b/app/src/main/java/com/myapp/catalog/ProductsDatabase.kt
index d39f759..55a61ce 100644
--- a/app/src/main/java/com/myapp/catalog/ProductsDatabase.kt
+++ b/app/src/main/java/com/myapp/catalog/ProductsDatabase.kt
@@ -68,7 +68,7 @@ class ProductsDatabase(val context: Context) : SQLiteOpenHelper(context, DATABAS
      fun selectProduct(filter:String?):Products
     {
         //var fil:String
-        val products = Products(context)
+        val products = Products()
         val db = this.readableDatabase
         //if (filter == null)
          //   fil = "All"
-- 
2.17.1

